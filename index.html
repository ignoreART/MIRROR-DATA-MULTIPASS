<!DOCTYPE html>
<!--
  MIRROR multipass card - Using TAIL Database + Dexie.space APIs
  
  This version uses alternative data sources that may have better CAT coverage:
  1. taildatabase.com - CAT token registry
  2. dexie.space - Chia DEX with token data
  3. Fallback to estimated/placeholder values
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MIRROR Multipass Card</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap');
    :root {
      --frame-bg: linear-gradient(145deg, #dcdcdc, #a8a8a8, #8d8d8d, #c2c2c2);
      --frame-border: #676a6c;
      --accent-color: #ff9500;
      --glass-tint: rgba(34, 139, 34, 0.15);
    }
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #101010;
      font-family: 'Orbitron', sans-serif;
      color: #e0e0e0;
    }
    #card {
      width: 480px;
      height: 650px;
      background: var(--frame-bg);
      border: 2px solid var(--frame-border);
      border-radius: 16px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.8);
      position: relative;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .accent {
      width: 30px;
      height: 30px;
      background: var(--accent-color);
      border-radius: 6px;
      position: absolute;
    }
    .accent.tl { top: 10px; left: 10px; }
    .accent.br { bottom: 10px; right: 10px; }
    #header {
      height: 90px;
      border-bottom: 1px solid rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      padding: 10px 20px;
    }
    #header h1 {
      font-size: 1.6rem;
      margin: 0;
      color: #222;
      margin-right: auto;
    }
    #header img.mirror-logo {
      width: 60px;
      height: 60px;
      margin-right: 16px;
    }
    #aeBadge {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, #e1e4e6, #c7c9cb, #f9f9fa);
      color: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
      border: 2px solid #a2a4a8;
      box-shadow:
        0 0 0 4px rgba(193, 137, 69, 0.6),
        inset 0 2px 3px rgba(255,255,255,0.8),
        inset 0 -2px 3px rgba(0,0,0,0.3);
    }
    #viewport {
      flex: 1;
      margin: 20px;
      border: 3px solid #444;
      border-radius: 12px;
      background: var(--glass-tint);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 16px;
    }
    #stats {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    #stats div {
      font-size: 1rem;
      color: #e7fff7;
      text-shadow: 0 0 4px rgba(0,255,255,0.8);
      display: flex;
      justify-content: space-between;
    }
    #stats div span:nth-child(1) {
      color: rgba(200, 255, 215, 0.8);
    }
    #footer {
      height: 70px;
      background: linear-gradient(90deg, #4f5152, #656667, #4f5152);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      border-top: 1px solid rgba(0,0,0,0.3);
    }
    #footer h2 {
      margin: 0;
      font-size: 1.2rem;
      color: #c0c8d0;
    }
    #footer p {
      margin: 2px 0 0;
      font-size: 0.7rem;
      color: #9aa2ac;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    .loading {
      animation: pulse 1.5s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    #statusIndicator {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ff4444;
    }
    #statusIndicator.active {
      background: #44ff44;
      box-shadow: 0 0 8px #44ff44;
    }
    #statusIndicator.trying {
      background: #ffaa00;
      box-shadow: 0 0 8px #ffaa00;
    }
    #statusIndicator.manual {
      background: #8888ff;
      box-shadow: 0 0 8px #8888ff;
    }
  </style>
</head>
<body>
  <div id="card">
    <div class="accent tl"></div>
    <div class="accent br"></div>
    <div id="statusIndicator"></div>
    
    <div id="header">
      <h1>MIRROR</h1>
      <img src="https://icons.dexie.space/0957ed359f099d5846c2c74c42e7c2eb9608b58c32e320e144840e3efab0b747.webp" class="mirror-logo" alt="Mirror logo" />
      <div id="aeBadge">√Ü</div>
    </div>
    
    <div id="viewport">
      <div id="stats">
        <div><span>Launch (UTC)</span><span id="launchDate">--</span></div>
        <div><span>Days Deployed</span><span id="days">--</span></div>
        <div><span>Holders</span><span id="holders" class="loading">Loading...</span></div>
        <div><span>Total Supply</span><span id="total" class="loading">Loading...</span></div>
        <div><span>Circulating</span><span id="circ" class="loading">Loading...</span></div>
        <div><span>Burned</span><span id="burned" class="loading">Loading...</span></div>
        <div><span>Price (XCH)</span><span id="price" class="loading">Loading...</span></div>
        <div><span>Today</span><span id="currentDate">--</span></div>
      </div>
      <div id="worldClocks" style="margin-top: 12px; font-size: 0.7rem; color: #b8f5e8; display: flex; flex-wrap: wrap; gap: 6px;"></div>
    </div>
    
    <div id="footer">
      <h2>Multipass</h2>
      <p id="lastUpdate">Initializing...</p>
    </div>
  </div>

  <script>
    // ========================================
    // CONFIGURATION
    // ========================================
    const TOKEN_ID = '0957ed359f099d5846c2c74c42e7c2eb9608b58c32e320e144840e3efab0b747';
    const LAUNCH_DATE = '2025-03-12T11:19:31Z';
    const UPDATE_INTERVAL = 10 * 60 * 1000;
    
    // MANUAL VALUES - Updated with hardcoded MIRROR token data
    const MANUAL_DATA = {
      enabled: true,  // Enabled to use hardcoded values
      holders: 2117,  // Total Holders: 2,117
      totalSupply: 31000000,  // Total Supply: 31,000,000 MIRROR
      circulatingSupply: 29908241.29,  // Circulating Supply: 29,908,241.29 MIRROR
      priceXch: 0  // Will try to fetch from API, or leave as 0 if not available
    };

    console.log('üöÄ MIRROR Multipass v3.0');
    console.log('üìä Token ID:', TOKEN_ID);

    // ========================================
    // HELPER FUNCTIONS
    // ========================================
    
    function setStatus(status) {
      const indicator = document.getElementById('statusIndicator');
      indicator.className = '';
      if (status) indicator.classList.add(status);
    }

    function updateTimestamp(message = '') {
      const now = new Date();
      const timeStr = now.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
      document.getElementById('lastUpdate').textContent = message || `Updated: ${timeStr}`;
    }

    // ========================================
    // STATIC DATA
    // ========================================
    
    const launchDateObj = new Date(LAUNCH_DATE);
    document.getElementById('launchDate').textContent = launchDateObj.toLocaleString(undefined, {
      year: 'numeric', month: 'numeric', day: 'numeric',
      hour: '2-digit', minute: '2-digit', hour12: true,
      timeZone: 'UTC'
    }) + ' UTC';

    const daysDiff = Math.floor((Date.now() - new Date(LAUNCH_DATE).getTime()) / (1000 * 60 * 60 * 24));
    document.getElementById('days').textContent = daysDiff.toString();

    function updateCurrentDate() {
      const now = new Date();
      document.getElementById('currentDate').textContent = now.toLocaleDateString(undefined, { 
        year: 'numeric', month: 'numeric', day: 'numeric' 
      });
    }
    updateCurrentDate();

    // ========================================
    // WORLD CLOCKS
    // ========================================
    
    const timeZones = [
      { label: 'UTC', zone: 'UTC' },
      { label: 'NY', zone: 'America/New_York' },
      { label: 'CHI', zone: 'America/Chicago' },
      { label: 'LA', zone: 'America/Los_Angeles' },
      { label: 'LON', zone: 'Europe/London' },
      { label: 'PAR', zone: 'Europe/Paris' },
      { label: 'DXB', zone: 'Asia/Dubai' },
      { label: 'MUM', zone: 'Asia/Kolkata' },
      { label: 'BEI', zone: 'Asia/Shanghai' },
      { label: 'TOK', zone: 'Asia/Tokyo' },
      { label: 'SYD', zone: 'Australia/Sydney' }
    ];
    
    const worldClocksContainer = document.getElementById('worldClocks');
    const clockElements = {};
    
    timeZones.forEach(tz => {
      const span = document.createElement('div');
      span.style.cssText = 'display:flex;flex-direction:column;align-items:center;padding:2px 4px;background:rgba(0,0,0,0.25);border-radius:4px;min-width:70px;text-align:center;';
      span.innerHTML = `<strong style="font-size:0.6rem;color:#8af8e5;">${tz.label}</strong><span style="font-size:0.65rem;">--</span>`;
      worldClocksContainer.appendChild(span);
      clockElements[tz.label] = span.querySelector('span:last-child');
    });
    
    function updateWorldClocks() {
      const now = new Date();
      timeZones.forEach(tz => {
        clockElements[tz.label].textContent = now.toLocaleTimeString(undefined, { 
          hour: '2-digit', minute: '2-digit', timeZone: tz.zone, hour12: false
        });
      });
    }
    
    updateWorldClocks();
    setInterval(() => {
      updateCurrentDate();
      updateWorldClocks();
    }, 1000);

    // ========================================
    // TOKEN DATA FETCHING
    // ========================================
    
    async function fetchTokenData() {
      console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
      console.log('üîÑ Loading MIRROR token data...');
      setStatus('trying');
      updateTimestamp('Loading...');
      
      document.querySelectorAll('.loading').forEach(el => el.classList.remove('loading'));
      
      // Check if manual mode is enabled
      if (MANUAL_DATA.enabled) {
        console.log('üìù Using MANUAL DATA mode with hardcoded values');
        setStatus('manual');
        
        // Try to fetch price from API (optional)
        let priceXch = MANUAL_DATA.priceXch;
        let xchToUsd = 0;
        
        try {
          xchToUsd = await getXchPrice();
          // Try to get MIRROR price from Dexie or other APIs
          if (!priceXch) {
            const dexieUrl = `https://api.dexie.space/v1/cats`;
            const dexieResponse = await fetch(dexieUrl);
            if (dexieResponse.ok) {
              const dexieData = await dexieResponse.json();
              const mirrorToken = dexieData.find(cat => cat.id === TOKEN_ID);
              if (mirrorToken && mirrorToken.price) {
                priceXch = parseFloat(mirrorToken.price || 0);
                console.log('‚úÖ Found price on Dexie:', priceXch);
              }
            }
          }
        } catch (e) {
          console.warn('Price fetch failed, using manual data only');
        }
        
        const burnedAmount = MANUAL_DATA.totalSupply - MANUAL_DATA.circulatingSupply;
        const priceUsd = priceXch * xchToUsd;
        
        // Update UI with hardcoded values
        document.getElementById('holders').textContent = MANUAL_DATA.holders.toLocaleString();
        document.getElementById('total').textContent = MANUAL_DATA.totalSupply.toLocaleString();
        document.getElementById('circ').textContent = MANUAL_DATA.circulatingSupply.toLocaleString();
        document.getElementById('burned').textContent = burnedAmount.toLocaleString();
        document.getElementById('price').textContent = priceXch 
          ? `${priceXch.toFixed(8)} XCH ($${priceUsd.toFixed(4)})`
          : 'Not Listed';
        
        updateTimestamp('Hardcoded Data');
        console.log('‚úÖ Manual data displayed');
        console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
        return;
      }
      
      try {
        // Try Dexie.space API
        console.log('üì° Trying Dexie.space API...');
        const dexieUrl = `https://api.dexie.space/v1/cats`;
        const dexieResponse = await fetch(dexieUrl);
        
        if (dexieResponse.ok) {
          const dexieData = await dexieResponse.json();
          const mirrorToken = dexieData.find(cat => cat.id === TOKEN_ID);
          
          if (mirrorToken) {
            console.log('‚úÖ Found on Dexie:', mirrorToken);
            
            const xchToUsd = await getXchPrice();
            const totalVal = parseFloat(mirrorToken.total_supply || 0) / 1000; // Convert mojos
            const priceXch = parseFloat(mirrorToken.price || 0);
            const priceUsd = priceXch * xchToUsd;
            
            document.getElementById('holders').textContent = mirrorToken.holders || 'N/A';
            document.getElementById('total').textContent = totalVal.toLocaleString();
            document.getElementById('circ').textContent = totalVal.toLocaleString();
            document.getElementById('burned').textContent = '0';
            document.getElementById('price').textContent = priceXch 
              ? `${priceXch.toFixed(8)} XCH ($${priceUsd.toFixed(4)})`
              : 'Not Listed';

            setStatus('active');
            updateTimestamp();
            console.log('‚úÖ Success via Dexie!');
            console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            return;
          }
        }
        
        // If all APIs fail
        throw new Error('Token not found in any API');
        
      } catch (err) {
        console.error('‚ùå API Error:', err.message);
        console.error('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
        
        setStatus('');
        updateTimestamp('Not indexed - see console');
        
        document.getElementById('holders').textContent = 'Not Indexed';
        document.getElementById('total').textContent = 'Not Indexed';
        document.getElementById('circ').textContent = 'Not Indexed';
        document.getElementById('burned').textContent = 'Not Indexed';
        document.getElementById('price').textContent = 'Not Listed';
      }
    }
    
    async function getXchPrice() {
      try {
        const response = await fetch('https://api.spacescan.io/stats/price?currency=usd');
        if (response.ok) {
          const data = await response.json();
          return parseFloat(data.price || 0);
        }
      } catch (e) {}
      return 0;
    }

    // ========================================
    // INITIALIZATION
    // ========================================
    
    fetchTokenData();
    setInterval(fetchTokenData, UPDATE_INTERVAL);
    console.log('‚è∞ Auto-refresh: Every 10 minutes');
    
  </script>
</body>
</html>
